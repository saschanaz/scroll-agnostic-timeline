<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <style>
    sa-timeline {
      display: block;
      width: 300px;
      height: 300px;
      overflow: auto;
    }

    .block {
      background-color: pink;
      height: 30px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 5px;
      margin: 5px;
    }

    .hole {
      background-color: lightpink;
      height: 30px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 5px;
      margin: 5px;
    }

    .hole:hover {
      border-style: solid;
      border-color: pink;
    }

    .hole:active {
      border-style: solid;
      border-color: hotpink;
    }

    .container:not(.hashole) .hole {
      display: none;
    }
  </style>
  <script>
    var require = dep => {
      if (dep === "visible-children-observer") {
        return VisibleChildrenObserver;
      }
      throw new Error("Unknown dependency");
    };
  </script>
  <script src="node_modules/@webcomponents/custom-elements/custom-elements.min.js"></script>
  <script src="node_modules/visible-children-observer/lib/index.js"></script>
  <script src="lib/index.js"></script>
  <script>
    customElements.define("sa-timeline", ScrollAgnosticTimeline.default);
    const timeline = new ScrollAgnosticTimeline.default;
    const holeBase = (() => {
      const hole = document.createElement("div");
      hole.classList.add("hole");
      hole.textContent = "Fill this hole";
      return hole;
    })();

    document.addEventListener("DOMContentLoaded", () => {
      timeline.compare = (x, y) => y.data.i - x.data.i;
      timeline.max = 30;
      document.body.appendChild(timeline);

      button.addEventListener("click", () => {
        const element = createBlock(Math.floor(Math.random() * 100000));
        timeline.appendChild(element);
      });

      function holeListener(ev) {
        const parent = ev.target.parentElement;
        ev.target.parentElement.classList.remove("hashole")
        const previousSiblingData = parent.previousSibling ? parent.previousSibling.data.i : (parent.data.i + 2)
        const middle = Math.floor((parent.data.i + previousSiblingData) / 2);
        timeline.appendChild(createBlock(middle));
      }

      function createBlock(i) {
        const container = document.createElement("div");
        container.classList.add("container");
        container.data = { i };
        const hole = holeBase.cloneNode(true);
        hole.addEventListener("click", holeListener);
        container.appendChild(hole);
        const element = document.createElement("div");
        element.classList.add("block");
        element.textContent = i;
        container.appendChild(element);
        return container;
      }
    });

    timeline.addEventListener("beforeautoremove", ev => {
      if (ev.exChild.nextSibling) {
        ev.exChild.nextSibling.classList.add("hashole");
      }
    });
  </script>
</head>

<body>
  <button id="button">Add random</button>
</body>

</html>
